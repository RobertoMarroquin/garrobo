{% extends 'base.html' %}
{% load humanize %} {% load static %} {% load crispy_forms_tags %}
{% block css %}
  <!--Select2 Filter CSS-->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />

{% endblock css %}

{% block content %}
<h5 class="text-center">{{libro.cliente.nombre}}</h5>
<h5 class="text-center">Facturas de Compras {{libro.get_mes_display}}/{{libro.ano}}</h5>
<hr>
<br>
<!------------------------------------------------------------------------------------------->
<!------------------------------------------------------------------------------------------->

<div class="row">
    <div class="col-md-2">
        <a name="" id="" class="btn btn-primary" href="{% url 'iva:lista_libro' libro.cliente.id libro.tipo %}"
            role="button">Libros</a>
    </div>
    <div class="col-md-4"></div>
    <div class="col-md-4"></div>
    <div class="col-md-2"><a name="" id="" class="btn btn-success" href="{% url 'iva:nueva_empresa2' libro.id %}"
        role="button">Nuevo Registro</a></div>
</div>
<!------------------------------------------------------------------------------------------->
<!------------------------------------------------------------------------------------------->
<div class="container">
    <form action="" method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-4">
                {{form.contribuyente|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.fecha|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.claseDocumento|as_crispy_field}}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{form.tipoDocumento|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.numeroResolucion|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.numeroSerie|as_crispy_field}}
            </div>
        </div> 
        <div class="row">
            <div class="col-md-4">
                {{form.numeroDocumento|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.numeroControlInterno|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.venExentas|as_crispy_field}}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{form.ventasNSujetas|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.venGravadas|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.ivaDebFiscal|as_crispy_field}}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                {{form.vtVentas|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.vtIVA|as_crispy_field}}
            </div>
            <div class="col-md-4">
                {{form.total|as_crispy_field}}
            </div>
        </div> 
        <div class="row">
            <div class="col-md-4">
                {{form.ivaRetenido|as_crispy_field}}
            </div>
            <div class="col-md-4 align-middle text-center">
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
            <div class="col-md-4">
            </div>
        </div> 
        
    </form>
</div>
<!------------------------------------------------------------------------------------------->
<!------------------------------------------------------------------------------------------->
<div class="container">
    <div class="table-responsive">
        <table id="tabla1" class="table table-striped table-sm">
            <caption>Facturas Registradas</caption>
            <thead class="thead-dark">
                <tr class="text-center">
                <th class="align-middle">Contribuyente</th>
                <th class="align-middle">Fecha</th>
                <th class="align-middle">Clase de Doc</th>
                <th class="align-middle">Tipo de Doc</th>
                <th class="align-middle">N Resol</th>
                <th class="align-middle">N Serie</th>
                <th class="align-middle">N de Doc</th>
                <th class="align-middle">N Cont Intr</th>
                <th class="align-middle">Ven Exen</th>
                <th class="align-middle">Ven No Suj</th>
                <th class="align-middle">Ven Grav</th>
                <th class="align-middle">IVA</th>
                <th class="align-middle">Ven 3ros</th>
                <th class="align-middle">IVA 3ros</th>
                <th class="align-middle">Total</th>
                <th class="align-middle">IVA ret</th>
            </tr>
            </thead>
            <tbody>
                {% for factura in facturas.all|dictsort:"fecha"  %}
                    <tr class="text-center">
                        <td class="align-middle">{{factura.contribuyente}}</td>
                        <td class="align-middle">{{factura.fecha}}</td>
                        <td class="align-middle">{{factura.claseDocumento}}</td>
                        <td class="align-middle">{{factura.tipoDocumento}}</td>
                        <td class="align-middle">{{factura.numeroResolucion}}</td>
                        <td class="align-middle">{{factura.numeroSerie}}</td>
                        <td class="align-middle">{{factura.numeroDocumento}}</td>
                        <td class="align-middle">{{factura.numeroControlInterno}}</td>
                        <td class="align-middle">{{factura.venExentas}}</td>
                        <td class="align-middle">{{factura.ventasNSujetas}}</td>
                        <td class="align-middle">{{factura.venGravadas}}</td>
                        <td class="align-middle">{{factura.ivaDebFiscal}}</td>
                        <td class="align-middle">{{factura.vtVentas}}</td>
                        <td class="align-middle">{{factura.vtIVA}}</td>
                        <td class="align-middle">{{factura.total}}</td>
                        <td class="align-middle">{{factura.ivaRetenido}}</td>
                    </tr>
                {% empty %}
                <tr class="text-center">
                    <td colspan=16 class="align-middle">No hay registros</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock content %}
{% block extrajs %}
  <!--Select2 Filter JS-->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            $("#id_contribuyente").select2();
            $('#id_contribuyente').show().focus().click();
        })
    </script>

    <script>
        function totalizado() {
            suma = parseFloat($("#id_vtIVA").val()) + parseFloat($("#id_ivaDebFiscal").val()) + parseFloat($("#id_venExentas").val()) + parseFloat($("#id_venGravadas").val()) + parseFloat($("#id_ventasNSujetas").val()) + parseFloat($("#id_vtVentas").val()) - parseFloat($("#id_ivaRetenido").val())
            $('#id_total').val(suma.toFixed(2))
        }

        $(document).change(()=>{
            totalizado()
        })
    </script>
{% endblock extrajs %}